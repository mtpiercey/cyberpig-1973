      SUBROUTINE EVNTS(IN,VEN)
      
      COMMON /INIT/ NR, NW, ND, NT7, NT8, NDAT, NS1, NS2
      COMMON /GEN/ ITOT, ISIZE, NOWT, NOWY, NDAYS, NRUNS, IATRIB(18), ATRIB(4)
      COMMON /HOUSE/ NH(6), N1, N2, N3, N4, N5, N6
      COMMON /SCH/ KS(2, 500), IPT, IEVT, KODE, IWE, IWN(45), NKT
C MTP: THIS WAS THE ORIGINAL COMMON STATEMENT, BUT THE COMPILER DIDN'T LIKE IT
C COMMON /BRED/ LBREED, NBREED, IFAR(6, 5), IDB(30), KAGEW, LGTHW, NAGEM
      COMMON /BRED/ LBREED, NBREED, IFAR(30), IDB(30), KAGEW, LGTHW, NAGEM
      COMMON /SKIP/ ISTOP4, ISTOP5, ISTOP6, ISTOP7, MAXSKP
      COMMON /CULL/ NGLTS, MXSRV, MXAGS, PCULG, PCULS, PSRR, PRGT
      COMMON /SALES/ MDSELL
      COMMON /CLEAN/ DUM(5), KL4
      COMMON /BOAR/ MXSDY, MXSWY, MXSDM, MXSWM, NPUR, IPDAT, KAGE, WTPB, IBS
      COMMON /WRT1/ KW
      COMMON /BRED4/ KBRD

C MTP: DON'T KNOW WHY DUM(5) IS IN /CLEAN/, BECAUSE NH4CLN FROM /CLEAN/ IS USED HERE

      DIMENSION IN(3,1), VEN(2,1)

C GET EVENTS FROM FILE ONE AT A TIME AND CALL FOR EXECUTION.

      KODE = 2
1111  CALL MGT2(IN, VEN)

      IF(IEVT-2) 1, 2, 33
33    IF(IEVT-4) 3, 4, 55
55    IF(IEVT-6) 5, 6, 77
77    IF(IEVT-8) 7, 98, 98


C UPDATE ALL ANIMALS, HOUSE AT TIME.
6     NDO1 = NH(1)
      IF(NDO1 .LT. 1) GO TO 545
      NN = 0
      DO 444 M = 1,NDO1
      KOL = 1 + NN
      IF(MOD(IN(2, KOL), 1000000) .GE. NOWT) GO TO 443
      CALL REMOV(IN, VEN, KOL)
      CALL UPDATE(IN, VEN)
      GO TO 444
443   NN = NN + 1
444   CONTINUE
545   NDO2 = NH(2)
      IF (NDO2 .LT .1) GO TO 656
      NN = 0
      KPN = N1
      DO 555 M = 1,NDO2
      KOL = N1 + NN + 1
      IF(MOD(IN(2, KOL), 1000000) .GE. NOWT) GO TO 553
      CALL REMOV(IN, VEN, KOL)
      CALL UPDATE(IN, VEN)
      IF(N1 .NE. KPN) NN = NN + N1 - KPN
      KPN = N1
      GO TO 555
553   NN = NN + 1
555   CONTINUE
656   NDO3 = NH(3)
      IF (NDO3 .LT. 1) GO TO 767
      NN = 0
      KPN = N2
      DO 666 M = 1,NDO3
      KOL = N2 + NN + 1
      IF(MOD(IN(2, KOL), 1000000) .GE. NOWT) GO TO 663
      CALL REMOV(IN, VEN, KOL)
      CALL UPDATE(IN, VEN)
      IF(N2 .NE. KPN) NN = NN + N2 - KPN
      KPN = N2
      GO TO 666
663   NN = NN + 1
666   CONTINUE
767   NDO4 = NH(4)
      IF(NDO4 .LT. 1) GO TO 878
      NN = 0
      KPN = N3
      DO 777 M = 1,NDO4
      KOL = N3 + NN + 1
      IF(MOD(IN(2, KOL), 1000000) .GE. NOWT) GO TO 773
      CALL REMOV(IN, VEN, KOL)
      CALL UPDATE(IN, VEN)
      IF(N3 .NE. KPN) NN = NN + N3 - KPN
      KPN = N3
      GO TO 777
773   NN = NN + 1
777   CONTINUE
878   NDO5 = NH(5)
      IF(NDO5 .LT. 1) GO TO 99
      DO 888 M = 1,NDO5
      CALL REMOV(IN, VEN, N4 + 1)
888   CALL UPDATE(IN, VEN)
      GO TO 99

 
C SELECT
C   MINIMUM AGE TARGET=150, 140 ALLOWS FOR VARIANCE.
1     CALL SELECT(IN, VEN, NGLTS, 140)
      GO TO 1111

C BREED FLIP SWITCH
2     IF(IBS .EQ. 2) GO TO 22
      IBS = 2
C       SET=2 IMPLIES END OF SEASON, CALL REPT1 WITH KW=3
      KW = 3
      CALL REPT1(IN, VEN)
      KW = 0
C SET NO SOWS EXPOSED (TARGET NO.) =0.
      KBRD = 0
      GO TO 1111
22    IBS = 1
      GO TO 1111


C CLEAN4, SETS CLEAN FLAG=1.
3     CALL CLEAN4(IN, VEN)
      KL4 = 0
      GO TO 1111

C WEAN, SET HOUSE 4 NOT CLEAN
4     NH4CLN=2

C MTP: GETTING RANK MISMATCH IN IN ARRAY REFERENCE AT (1)(1/2) HERE
C BECAUSE IFAR IS DECLARED AS IFAR(6,5) IN COMMON/BRED/LBREED

C MTP: CHANGING IT TO IDB(30) DOESN'T FIX THE INFINITE LOOP

C NO. FARROWING WITHIN YEAR NOWY, STORE IN IFAR(30)
      IFAR(30) = IFAR(30) + 1
      IF(IFAR(30)-6) 400, 400, 47
47    IFAR(30) = 1
400   CONTINUE


C FIRST DAY WEANING, SET UP SCHEDULE HERE IN IWN(45)
C   SET BY SUB. CLEAN4.
C   NKT SET=0 FOR COUNTER START IN SUB. MGT3.
      NKT = 0
      IWE = 1
C   IF LGTHW=1 DAY, USE CLEAN4 TO WEAN ALL.
      IF(LGTHW-2) 401, 420, 420
401   CALL CLEAN4(IN, VEN)
      GO TO 1111
420   IF(KL4) 449, 449, 435


C SCHEDULE -KL4- WEANINGS WITHIN -LGTHW- DAYS.
C       METHOD- ADD DIGITS FROM RIGHT TO LEFT INTO THE
C           LGTHW WORDS OF IWN().
435   KNT = 0
      DO 437 I = 1,45
437   IWN(I) = 0
439   DO 441 K = 1,LGTHW
      KK = LGTHW - K + 1
      KNT = KNT + 1
      IF(KNT-KL4) 440, 440, 449
440   IWN(KK) = IWN(KK) + 1
441   CONTINUE
      IF(KNT-KL4) 439, 449, 449

C NKT=WEANING SEASON DAY COUNTER FOR SUB. MGT3.
449   NKT = 0
      GO TO 1111

C SELL
5     CALL SELL(IN, VEN)
      GO TO 1111

 
C BUY BOARS ROUTINE
7     IF(NPUR) 1111, 1111, 701
701   DO 708 I = 1,NPUR
      IATRIB(I) = KAGE
      IATRIB(2) = 1
      IATRIB(3) = 1
      IATRIB(4) = 1
      IATRIB(5) = 88 * 1000 + NOWY * 100 + I
      ATRIB(1) = WTPB
      CALL FILEM(IN, VEN, 8)
708   CONTINUE
      WRITE(ND, 709) NOWY, NOWT, NPUR
709   FORMAT(/3X'BOAR PURCHASE FOR YEAR'I2' AT DAY='I5' ADDED 'I3' NEW BOARS')
      GO TO 1111
98    WRITE(ND, 1309) NOWT, IEVT, IPT, KODE, IWE
1309  FORMAT(/' ERROR EVNTS, NOWT='I6' IEVT='I3'IPT='I6' KODE='I3' IWE='I2/)

99    RETURN
      END